"use strict";(self.webpackChunkprotoconf=self.webpackChunkprotoconf||[]).push([[772],{908:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var i=n(5893),r=n(3905);const o={id:"validation",title:"Configuration Validation",sidebar_position:3},a="Configuration Validation",c={id:"validation",title:"Configuration Validation",description:"protoconf provides a way to add validation rules to your configuration. These rules allow you to ensure that the configuration values meet certain criteria before they are used by your application. Validation rules are written in separate Starlark files with the -validator suffix, and they are associated with your configuration using the add_validator function.",source:"@site/docs/validation.mdx",sourceDirName:".",slug:"/validation",permalink:"/docs/0.1.7/validation",draft:!1,unlisted:!1,editUrl:"https://github.com/protoconf/protoconf/tree/main/website/protoconf/docs/validation.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{id:"validation",title:"Configuration Validation",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Getting Started",permalink:"/docs/0.1.7/getting-started"},next:{title:"Consuming Configuration Updates",permalink:"/docs/0.1.7/consume-config-updates"}},s={},l=[{value:"Writing a Validation Rule",id:"writing-a-validation-rule",level:2}];function d(e){const t={code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,r.ah)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h1,{id:"configuration-validation",children:"Configuration Validation"}),"\n",(0,i.jsxs)(t.p,{children:["protoconf provides a way to add validation rules to your configuration. These rules allow you to ensure that the configuration values meet certain criteria before they are used by your application. Validation rules are written in separate Starlark files with the ",(0,i.jsx)(t.code,{children:"-validator"})," suffix, and they are associated with your configuration using the ",(0,i.jsx)(t.code,{children:"add_validator"})," function."]}),"\n",(0,i.jsx)(t.h2,{id:"writing-a-validation-rule",children:"Writing a Validation Rule"}),"\n",(0,i.jsxs)(t.p,{children:["Create a new Starlark file with the ",(0,i.jsx)(t.code,{children:"-validator"})," suffix. For example, for a configuration defined in ",(0,i.jsx)(t.code,{children:"./src/myproject/v1/server_config.proto"}),", the validation file would be ",(0,i.jsx)(t.code,{children:"./src/myproject/v1/server_config.proto-validator"}),"."]}),"\n",(0,i.jsx)(t.p,{children:"In this file, load the configuration message, define a validation function, and then add the validator:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",metastring:"title=./src/myproject/v1/server_config.proto-valdator",children:'load("//myproject/v1/server_config.proto", "ServerConfiguration")\n\ndef validate_server_config(config):\n    if config.max_connections < 1:\n        fail("max_connections must be at least 1")\n\n    if config.max_payload_size_mb < 0.1 or config.max_payload_size_mb > 100.0:\n        fail("max_payload_size_mb must be between 0.1 and 100.0")\n\n    if config.request_timeout.seconds < 1:\n        fail("request_timeout must be at least 1 second")\n\nadd_validator(ServerConfiguration, validate_server_config)\n'})}),"\n",(0,i.jsxs)(t.p,{children:["In this example, ",(0,i.jsx)(t.code,{children:"validate_server_config"})," is a function that checks whether ",(0,i.jsx)(t.code,{children:"max_connections"})," is at least 1, ",(0,i.jsx)(t.code,{children:"max_payload_size_mb"})," is between 0.1 and 100.0, and ",(0,i.jsx)(t.code,{children:"request_timeout"})," is at least 1 second. If any of these conditions is not met, the function calls ",(0,i.jsx)(t.code,{children:"fail()"})," with an error message."]}),"\n",(0,i.jsxs)(t.p,{children:["After defining the validation function, ",(0,i.jsx)(t.code,{children:"add_validator()"})," is called to associate the validation function with the ",(0,i.jsx)(t.code,{children:"ServerConfiguration"})," message. Now, whenever a ",(0,i.jsx)(t.code,{children:"ServerConfiguration"})," object is created, its values will be validated according to these rules."]}),"\n",(0,i.jsx)(t.p,{children:"With validation in place, you can ensure that your configuration values are always within acceptable ranges, preventing errors due to incorrect configurations."})]})}function u(e={}){const{wrapper:t}={...(0,r.ah)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},3905:(e,t,n)=>{n.d(t,{ah:()=>l});var i=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=i.createContext({}),l=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},u=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),f=l(n),p=r,h=f["".concat(s,".").concat(p)]||f[p]||d[p]||o;return n?i.createElement(h,a(a({ref:t},u),{},{components:n})):i.createElement(h,a({ref:t},u))}));u.displayName="MDXCreateElement"}}]);