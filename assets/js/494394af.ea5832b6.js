"use strict";(self.webpackChunkprotoconf=self.webpackChunkprotoconf||[]).push([[6842],{3905:(e,n,r)=>{r.d(n,{Zo:()=>u,kt:()=>g});var o=r(7294);function t(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function a(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,o)}return r}function i(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?a(Object(r),!0).forEach((function(n){t(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function s(e,n){if(null==e)return{};var r,o,t=function(e,n){if(null==e)return{};var r,o,t={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],n.indexOf(r)>=0||(t[r]=e[r]);return t}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(t[r]=e[r])}return t}var l=o.createContext({}),p=function(e){var n=o.useContext(l),r=n;return e&&(r="function"==typeof e?e(n):i(i({},n),e)),r},u=function(e){var n=p(e.components);return o.createElement(l.Provider,{value:n},e.children)},m="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},d=o.forwardRef((function(e,n){var r=e.components,t=e.mdxType,a=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=p(r),d=t,g=m["".concat(l,".").concat(d)]||m[d]||c[d]||a;return r?o.createElement(g,i(i({ref:n},u),{},{components:r})):o.createElement(g,i({ref:n},u))}));function g(e,n){var r=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var a=r.length,i=new Array(a);i[0]=d;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[m]="string"==typeof e?e:t,i[1]=s;for(var p=2;p<a;p++)i[p]=r[p];return o.createElement.apply(null,i)}return o.createElement.apply(null,r)}d.displayName="MDXCreateElement"},1485:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>a,metadata:()=>s,toc:()=>p});var o=r(7462),t=(r(7294),r(3905));const a={title:"Employee Directory as Code"},i=void 0,s={unversionedId:"use-cases/employee-directory",id:"use-cases/employee-directory",title:"Employee Directory as Code",description:"Use Case: Centralized Employee Management",source:"@site/docs/use-cases/employee-directory.mdx",sourceDirName:"use-cases",slug:"/use-cases/employee-directory",permalink:"/docs/use-cases/employee-directory",draft:!1,editUrl:"https://github.com/protoconf/protoconf/tree/main/website/protoconf/docs/use-cases/employee-directory.mdx",tags:[],version:"current",frontMatter:{title:"Employee Directory as Code"},sidebar:"tutorialSidebar",previous:{title:"Use Cases",permalink:"/docs/category/use-cases"},next:{title:"Protoconf for Platform Engineering",permalink:"/docs/use-cases/platform-engineering"}},l={},p=[{value:"Use Case: Centralized Employee Management",id:"use-case-centralized-employee-management",level:2},{value:"Overview",id:"overview",level:3},{value:"Step 1: Define the Employee and Group Messages",id:"step-1-define-the-employee-and-group-messages",level:3},{value:"Step 2: Creating Employees and Groups Configuration",id:"step-2-creating-employees-and-groups-configuration",level:3},{value:"Step 3: Deploy and Use the Employee and Groups Directory",id:"step-3-deploy-and-use-the-employee-and-groups-directory",level:3},{value:"Step 4: Manage Access Control",id:"step-4-manage-access-control",level:3}],u={toc:p},m="wrapper";function c(e){let{components:n,...r}=e;return(0,t.kt)(m,(0,o.Z)({},u,r,{components:n,mdxType:"MDXLayout"}),(0,t.kt)("h2",{id:"use-case-centralized-employee-management"},"Use Case: Centralized Employee Management"),(0,t.kt)("h3",{id:"overview"},"Overview"),(0,t.kt)("p",null,"In this use case, we'll show how to use Protoconf to automate employee onboarding and offboarding processes, manage access control, and maintain a clear and accurate record of employee data."),(0,t.kt)("h3",{id:"step-1-define-the-employee-and-group-messages"},"Step 1: Define the Employee and Group Messages"),(0,t.kt)("p",null,"First, we need to define our ",(0,t.kt)("inlineCode",{parentName:"p"},"Employee")," and ",(0,t.kt)("inlineCode",{parentName:"p"},"Group")," protobuf messages:"),(0,t.kt)("p",null,"For ",(0,t.kt)("inlineCode",{parentName:"p"},"Employee"),":"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-protobuf",metastring:"title=./src/directory/employee/v1/employee.proto",title:"./src/directory/employee/v1/employee.proto"},'syntax = "proto3";\npackage directory.employee.v1;\n\nmessage Employee {\n  uint64 id = 1;\n  string unix_name = 2;\n  string first_name = 3;\n  string last_name = 4;\n  PhoneNumber personal_phone_number = 5;\n  repeated PhoneNumber additional_phone_numbers = 6;\n  string private_email = 7;\n  bool active_employee = 8;\n\n  repeated string ssh_keys = 10;\n  string github_user = 11;\n\n  string title = 50;\n  string biography = 51;\n\n  message PhoneNumber {\n    uint32 country_code = 1;\n    uint64 number = 2;\n    uint32 prefix = 3;\n  }\n}\n')),(0,t.kt)("p",null,"We can also add validators to our Employee:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-python",metastring:"title=./src/directory/employee/v1/employee.proto-validator",title:"./src/directory/employee/v1/employee.proto-validator"},'"""\nValidates employee\n"""\nload("employee.proto", "Employee")\n\n\ndef validate_employee(e):\n    if e.id < 1:\n        fail("Employee.id must be greater than 0")\n\n    if len(e.unix_name) <= 2:\n        fail("unix_name length must be at least 2 chars, got: %s" % e.unix_name)\n\nadd_validator(Employee, validate_employee)\n')),(0,t.kt)("p",null,"For ",(0,t.kt)("inlineCode",{parentName:"p"},"Group"),":"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-protobuf"},'syntax = "proto3";\npackage directory.groups.v1;\n\nimport "directory/employee/v1/employee.proto";\n\nmessage Group {\n    string name = 1;\n    string oncall = 2;\n    string slack_channel = 3;\n    repeated directory.employee.v1.Employee members = 4;\n    repeated Group subgroups = 5;\n}\n')),(0,t.kt)("h3",{id:"step-2-creating-employees-and-groups-configuration"},"Step 2: Creating Employees and Groups Configuration"),(0,t.kt)("p",null,"Create a Protoconf configuration file that will contain the list of Employee and Group messages."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-python",metastring:"title=./src/directory/directory.pinc",title:"./src/directory/directory.pinc"},'load("//directory/employee/v1/employee.proto", "Employee")\nload("//directory/groups/v1/groups.proto", "Group")\n\nemployees = [\n    # Add Employee objects here\n]\n\ngroups = [\n    # Add Group objects here\n]\n\nALL_GROUPS = Group(subgroups=groups)\n\n# Helpers:\ndef get_employees_for_group(group, inactive=False):\n    members = set([m for m in group.members if m.active_employee or inactive])\n    for g in group.subgroups:\n        members = members.union(get_employees_for_group(g, inactive))\n    return members\n\n\ndef get_all_employees(inactive=False):\n    return get_employees_for_group(ALL_GROUPS, inactive)\n\n\ndef get_groups_for_employee(e, group=ALL_GROUPS):\n    groups = set([g for g in [group] if e in set(g.members)])\n    for gg in group.subgroups:\n        groups = groups.union(get_groups_for_employee(e, gg))\n    return groups\n\ndef walk_groups(func, group=ALL_GROUPS, visited=set()):\n    func(group, visited)\n    visited=visited.union([group])\n    for g in group.subgroups:\n        walk_groups(func, g, visited)\n')),(0,t.kt)("p",null,"In this file, you can specify details about each employee and the groups they belong to. Ensure that each employee has a unique id and unix_name to avoid duplications."),(0,t.kt)("h3",{id:"step-3-deploy-and-use-the-employee-and-groups-directory"},"Step 3: Deploy and Use the Employee and Groups Directory"),(0,t.kt)("p",null,"Deploy the employee and groups configuration using ",(0,t.kt)("inlineCode",{parentName:"p"},"protoconf deploy"),"."),(0,t.kt)("p",null,"The deployed configuration can be integrated with various platforms and tools, such as:"),(0,t.kt)("ol",null,(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("strong",{parentName:"li"},"GitHub:")," Each employee's GitHub username can be automatically added to the company's GitHub organization using Terraform's GitHub provider. The ",(0,t.kt)("inlineCode",{parentName:"li"},"ssh_keys")," field can be used to add the employee's SSH keys to their GitHub profile.")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-python"},'load("//terraform/v1/util.pinc", "util")\nload("//terraform/github/provider/v4/github.proto", "Github")\nload("//terraform/github/resources/v4/membership.proto", "GithubMembership")\nload("//terraform/github/resources/v4/team.proto", "GithubTeam", "GithubTeamMembership")\nload("//directory/directory.pinc", "get_all_employees", "walk_groups)\n\ndef github_teams():\n    resources=[]\n    def run(group, visited):\n        return if group in visited\n        team=util.Resource(\n            group.name, GithubTeam(name=group.name),\n            lambda team: (util.Group(\n                *[util.Resource("%s-%s" % (group.name, member.name),\n                    GithubTeamMembership(team_id=team.id, username=employee.github_user)\n                ) for member in get_employees_for_group(group)]\n            ))\n        )\n        resources.append(team)\n    walk_groups(run)\n    return resources\n\ntf = util.Terraform(\n    util.Provider(Github(\n        organization="your-organization",\n        token="your-token", # Better to get from terraform variable or GITHUB_TOKEN environment variable\n    ),\n    *[util.Resource(\n        employee.unix_name, GithubMembership(username=employee.github_user))\n        for employee in get_all_employees()\n    ],\n    *github_teams()\n)\n')),(0,t.kt)("ol",{start:2},(0,t.kt)("li",{parentName:"ol"},(0,t.kt)("strong",{parentName:"li"},"AD/GSuite/Okta:")," An account can be created for each employee, using their Unix name as the username. If the ",(0,t.kt)("inlineCode",{parentName:"li"},"active_employee")," field is set to ",(0,t.kt)("inlineCode",{parentName:"li"},"false"),", the account can be automatically disabled. For GSuite, you can use the ",(0,t.kt)("a",{parentName:"li",href:"https://registry.terraform.io/providers/DeviaVir/gsuite/latest/docs"},"GSuite Terraform provider"),".")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-python"},'"""\nManages users and groups in the gsuite\n"""\nload("//terraform/v1/terraform.proto", "Terraform")\nload(\n    "//terraform/gsuite/resources/v0/domain.proto",\n    "GsuiteDomain",\n)\nload(\n    "//terraform/gsuite/resources/v0/group.proto",\n    "GsuiteGroup",\n    "GsuiteGroupMember",\n)\nload(\n    "//terraform/gsuite/resources/v0/user.proto",\n    "GsuiteUser",\n)\nload("//terraform/gsuite/provider/v0/gsuite.proto", "Gsuite")\nload("//terraform/v1/util.pinc", "util")\n\nMASTER_DOMAIN = "example.com"\nADDITIONAL_DOMAINS = ["example.org", "example.net"]\n\ntf = util.Terraform(\n    util.Provider(Gsuite(\n        oauth_scopes=[\n            "https://www.googleapis.com/auth/admin.directory.group",\n            "https://www.googleapis.com/auth/apps.groups.settings",\n            "https://www.googleapis.com/auth/admin.directory.user",\n            "https://www.googleapis.com/auth/admin.directory.userschema",\n            "https://www.googleapis.com/auth/admin.directory.domain",\n        ],\n        impersonated_user_email="admin@%s" % MASTER_DOMAIN,\n    )),\n    util.Resource("domain", GSuiteDomain(domain_name=MASTER_DOMAIN)),s\n    *[util.Resource(employee.unix_name, GsuiteUser(\n            primary_email="%s@%s" % (employee.unix_name, MASTER_DOMAIN),\n            aliases=["%s@%s" % (employee.unix_name, domain) for domain in ADDITIONAL_DOMAINS],\n            name={"family_name": employee.last_name, "given_name": employee.first_name},\n            recovery_email=employee.private_email,\n            recovery_phone="+%d%d" % (\n                employee.personal_phone_number.country_code,\n                employee.personal_phone_number.number\n            ),\n            posix_accounts=[\n                GsuiteUser.PosixAccounts(\n                    home_directory="/home/%s" % (employee.unix_name),\n                    primary=True,\n                    gid=employee.id,\n                    uid=employee.id,\n                    shell="/bin/bash",\n                    system_id="uid",\n                    username=employee.unix_name,\n                )\n            ],\n            external_ids=[GsuiteUser.ExternalIds(type="organization", value=str(employee.id))],\n            update_existing=True,\n        )) for employee in get_all_employees()\n    ]\n)\n')),(0,t.kt)("h3",{id:"step-4-manage-access-control"},"Step 4: Manage Access Control"),(0,t.kt)("p",null,"Once the employees have been added to these platforms, you can use Protoconf to manage their access to various resources."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-python"},'def github_teams():\n    resources=[]\n    def run(group, visited):\n        return if group in visited\n        team=util.Resource(\n            group.name, GithubTeam(name=group.name),\n            lambda team: (util.Group(\n                *[util.Resource("%s-%s" % (group.name, member.name),\n                    GithubTeamMembership(team_id=team.id, username=employee.github_user)\n                ) for member in get_employees_for_group(group)]\n            ))\n        )\n        resources.append(team)\n    walk_groups(run)\n    return resources\n\ndef gsuite_groups():\n    resources=[]\n    def run(group, visited):\n        return if group in visited\n        team=util.Resource(group.name, GsuiteGroup(\n                email="%s@%s" % (group.name.lower(), MASTER_DOMAIN),\n                name=group.name,\n            ),\n            lambda team: (util.Group(\n                *[util.Resource("%s-%s" % (group.name, member.name),\n                    GsuiteGroupMember(\n                        group=team.email,\n                        email="%s@%s", (member.unix_name, MASTER_DOMAIN),\n                        role="MEMBER",\n                ) for member in get_employees_for_group(group)]\n            ))\n        )\n        resources.append(team)\n    walk_groups(run)\n    return resources\n')),(0,t.kt)("p",null,'In this example, we are adding each member of the group to the corresponding team on GitHub. The on-call member is given the role of "maintainer".'),(0,t.kt)("p",null,"By using Protoconf to manage your employee directory, you will gain the following advantages:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Easier onboarding and offboarding:")," Once an employee is added to or removed from the Protoconf configuration, their access to all associated platforms is automatically updated."),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Access clarity:")," It's easy to see who has access to what, since all access data is contained in the Protoconf configuration."),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Easy access management:")," Granting and revoking access is as simple as updating the Protoconf configuration."),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Version control:")," All changes to the configuration are tracked in version control, providing an audit trail for compliance and accountability purposes.")),(0,t.kt)("p",null,"Please ensure to handle sensitive information such as passwords, tokens, and keys securely when using Protoconf and Terraform."),(0,t.kt)("p",null,"In this guide, we've only scratched the surface of what's possible with Protoconf. With its ability to integrate with a wide range of tools and platforms, Protoconf can be a powerful addition to your organization's infrastructure."))}c.isMDXComponent=!0}}]);